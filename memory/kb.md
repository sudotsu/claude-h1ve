# Knowledge Base

Structured reference of discovered facts, gotchas, and system behaviors that are worth knowing across sessions and machines. Edited in-place — entries are updated or replaced when superseded, never just appended. High signal-to-noise: only add things that would bite you again or save real time.

**CRITICAL RULE FOR ALL AGENTS:** You are strictly forbidden from writing conversational paragraphs in this file. Every new or updated entry MUST follow this exact format:

### [Specific Issue or Capability]
* **Symptom/Context:** (One concise sentence describing what broke or what the objective was)
* **Root Cause/Mechanic:** (Why it failed, or how the underlying system actually works)
* **Execution/Fix:** (The exact command, pathing, or code required to solve it)

---

## Claude Code

### CLAUDE.md directory tree walking
* **Symptom/Context:** Project-level Claude instructions aren't being read even though the file exists in the repo.
* **Root Cause/Mechanic:** Claude Code walks up the directory tree from the launch directory, reading every `CLAUDE.md` found. `~/.claude/CLAUDE.md` is always read; project-level files are only read if Claude Code is launched from within or below that directory.
* **Execution/Fix:** Symlink `projects/<name>/CLAUDE.md` into the project's working directory, or always launch Claude Code from the project root.

### machines/<name>/CLAUDE.md is a generated build artifact
* **Symptom/Context:** Machine specs or paths updated directly in CLAUDE.md were silently overwritten on next sync.
* **Root Cause/Mechanic:** `machines/<name>/CLAUDE.md` is generated by `propagate.sh` from `machine.md` + `shared/CLAUDE-shared.md`. Any direct edits are destroyed on rebuild.
* **Execution/Fix:** Edit `machines/<name>/machine.md` for machine-specific changes; edit `shared/CLAUDE-shared.md` for shared rules. Run `scripts/propagate.sh` to rebuild (or let `sync.sh` do it automatically).

### UserPromptSubmit hook fires on --resume
* **Symptom/Context:** Expected the session-start pull to be skipped on `claude --resume`, but it fires anyway.
* **Root Cause/Mechanic:** `--resume` starts a new process with a new PID. The PPID-based lockfile from the original session doesn't exist for the new process, so `session-start.sh` runs and pulls as if it's a fresh session.
* **Execution/Fix:** Intentional — resumed sessions get a fresh pull just like new sessions. No action needed.

---

## Windows / WSL

### Claude Code hook pathing trap (native Windows + WSL installed)
* **Symptom/Context:** Claude Code hooks silently fail to run on Windows machines with both Git Bash and WSL installed.
* **Root Cause/Mechanic:** Claude Code's hook runner resolves `/bin/bash` to the WSL shim (`C:\Windows\System32\bash.exe`), which cannot resolve Git Bash paths (`/c/Users/...`) or Windows-native paths (`C:\Users\...`).
* **Execution/Fix:** Route hooks through PowerShell to explicitly invoke Git Bash: `powershell.exe -NoProfile -Command "& 'C:/Program Files/Git/bin/bash.exe' 'C:/path/to/script.sh'"` — see `machines/_example-windows-native/` for full settings.json.

### Do not copy shared/settings.json on native Windows machines
* **Symptom/Context:** Hooks silently break after copying the shared settings template to a native Windows machine.
* **Root Cause/Mechanic:** `shared/settings.json` uses `$HOME` which the WSL shim resolves incorrectly on native Windows.
* **Execution/Fix:** Manually create `~/.claude/settings.json` with the PowerShell wrapper — see `machines/_example-windows-native/machine.md` for the exact config.

---

## Git

### autocrlf on Linux vs Windows
* **Symptom/Context:** CRLF warnings appear on commit when collaborating across Windows and Linux machines.
* **Root Cause/Mechanic:** `autocrlf=true` on Windows converts LF→CRLF on checkout and CRLF→LF on commit. `autocrlf=input` on Linux converts CRLF→LF on commit only. Mismatched settings cause noisy but benign warnings.
* **Execution/Fix:** Windows: `git config --global core.autocrlf true` | Linux: `git config --global core.autocrlf input`

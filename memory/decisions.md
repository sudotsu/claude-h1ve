# Decisions

Architectural, workflow, and tooling decisions.
Record these so future sessions don't re-debate settled questions.
Append new entries — never delete old ones.

---

## State files stay as snapshots, not append-only logs
**Decision:** `memory/shared.md`, `memory/projects.md` are always current-state snapshots. They are overwritten, not appended to. Only `decisions.md` is append-only.

**Why:** Append-only state files force every future session to read a growing history of outdated information and synthesize current state from it — burning context window and degrading reasoning quality over time. Git already provides version history. Memory files should reflect current reality, not accumulated history.

## Dual-boot machines get one profile per OS, not one per machine
**Decision:** A machine running two operating systems (e.g. Linux Mint + Windows 11 on separate drives) gets two separate `machines/` profiles — one per OS.

**Why:** The two environments have different shells, paths, tool installations, and hook setups. A single profile trying to cover both produces contradictory instructions. Splitting by OS gives each Claude instance a clean, unambiguous context for the environment it's actually running in.

## CLAUDE.md is a generated artifact — never edit it directly
**Decision:** `machines/<name>/CLAUDE.md` is generated by `propagate.sh` from `machine.md` + `shared/CLAUDE-shared.md`. Direct edits to CLAUDE.md are forbidden.

**Why:** The marker-based approach (sed + `<!-- SHARED -->`) was a single point of failure — a missing or corrupted marker silently broke propagation or corrupted the file. Concatenation from two source files has no dependency on file content. Additionally, any direct edit to CLAUDE.md is silently destroyed on the next propagate run, creating a hard-to-debug overwrite vector.

## Handoff archive mechanic — resolved handoffs move to handoffs/archive/
**Decision:** Resolved handoffs are moved to `handoffs/archive/` immediately. Session start scans only the root `handoffs/` directory.

**Why:** To determine if a handoff is open or resolved, an agent must read the file (status is inside, not in the filename). Without an archive, every session start reads every resolved handoff ever written. As the number of resolved handoffs grows, this silently burns context window on stale data. The archive makes the distinction mechanical — root = active, archive = history.

## .draft protocol + scratch/ quarantine for auto-sync safety
**Decision:** New files are written as `<name>.md.draft` and renamed to `<name>.md` only when complete. All temp files go in `scratch/`. Both are gitignored.

**Why:** `sync.sh` uses `git add -A` which commits everything in the working tree. Without protection, a session crash mid-write broadcasts half-written handoffs or incomplete decisions to every machine. `.draft` files stay untracked locally on crash. `scratch/` quarantines temp files, test scripts, and any credential-bearing output from ever entering the auto-sync pipeline.
